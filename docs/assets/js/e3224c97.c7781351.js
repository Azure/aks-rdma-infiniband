"use strict";(self.webpackChunkaks_rdma_infiniband=self.webpackChunkaks_rdma_infiniband||[]).push([[624],{3716:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"getting-started/prerequisites","title":"Prerequisites","description":"This section details the prerequisites for deploying an AKS cluster with support for Remote Direct Memory Access (RDMA) over InfiniBand, including optional configurations for GPUDirect RDMA.","source":"@site/docs/getting-started/02-prerequisites.md","sourceDirName":"getting-started","slug":"/getting-started/prerequisites","permalink":"/aks-rdma-infiniband/getting-started/prerequisites","draft":false,"unlisted":false,"editUrl":"https://github.com/Azure/aks-rdma-infiniband/blob/main/website/docs/getting-started/02-prerequisites.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Prerequisites"},"sidebar":"sidebar","previous":{"title":"Introduction","permalink":"/aks-rdma-infiniband/"},"next":{"title":"Network Operator","permalink":"/aks-rdma-infiniband/configurations/network-operator"}}');var i=r(4848),t=r(8453);const o={title:"Prerequisites"},a=void 0,d={},l=[{value:"AKS Cluster",id:"aks-cluster",level:2},{value:"AKS Nodepools",id:"aks-nodepools",level:2},{value:"Register AKS Infiniband Support Feature",id:"register-aks-infiniband-support-feature",level:3},{value:"Nodepool with GPUs",id:"nodepool-with-gpus",level:3},{value:"GPU Operator Managed GPU Driver",id:"gpu-operator-managed-gpu-driver",level:4},{value:"AKS Managed GPU Driver",id:"aks-managed-gpu-driver",level:4},{value:"Nodepool without GPUs",id:"nodepool-without-gpus",level:3},{value:"Appendix",id:"appendix",level:2},{value:"Understanding VM Size Naming Convention of ND-series",id:"understanding-vm-size-naming-convention-of-nd-series",level:3},{value:"Examples",id:"examples",level:4}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This section details the prerequisites for deploying an AKS cluster with support for Remote Direct Memory Access (RDMA) over InfiniBand, including optional configurations for GPUDirect RDMA."}),"\n",(0,i.jsx)(n.h2,{id:"aks-cluster",children:"AKS Cluster"}),"\n",(0,i.jsx)(n.p,{children:"An active AKS cluster is required as the foundation for deploying RDMA over InfiniBand capabilities. The cluster serves as the Kubernetes environment where Network Operator and GPU Operator (if using GPUDirect RDMA) will be installed."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Requirement"}),": Create an AKS cluster using the ",(0,i.jsx)(n.a,{href:"https://portal.azure.com",children:"Azure Portal"})," or ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/cli/azure/aks?view=azure-cli-latest",children:"Azure CLI"}),". Ensure the cluster is running a supported Kubernetes version compatible with ",(0,i.jsx)(n.a,{href:"https://docs.nvidia.com/networking/display/kubernetes2540/platform-support.html",children:"Network Operator"})," and / or ",(0,i.jsx)(n.a,{href:"https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/latest/platform-support.html",children:"GPU Operator"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Configuration"}),": The cluster must be deployed in a region that supports the required VM sizes with RDMA over InfiniBand capabilities."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"To create an AKS cluster, use the following Azure CLI command as a starting point:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export AZURE_RESOURCE_GROUP="myResourceGroup"\nexport AZURE_REGION="eastus"\nexport CLUSTER_NAME="myAKSCluster"\nexport NODEPOOL_NAME="ibnodepool"\nexport NODEPOOL_NODE_COUNT="2"\nexport NODEPOOL_VM_SIZE="Standard_ND96asr_v4"\n\naz group create \\\n  --name "${AZURE_RESOURCE_GROUP}" \\\n  --location "${AZURE_REGION}"\n\naz aks create \\\n  --resource-group "${AZURE_RESOURCE_GROUP}" \\\n  --name "${CLUSTER_NAME}" \\\n  --node-count 1 \\\n  --generate-ssh-keys\n'})}),"\n",(0,i.jsx)(n.p,{children:"Additional nodepools will be added in the next step to meet specific hardware requirements."}),"\n",(0,i.jsx)(n.h2,{id:"aks-nodepools",children:"AKS Nodepools"}),"\n",(0,i.jsx)(n.p,{children:"The AKS cluster requires a dedicated nodepool configured to support RDMA over InfiniBand. For AI workloads leveraging GPUDirect RDMA, GPU support is also necessary."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Requirement"}),(0,i.jsx)(n.th,{children:"Recommended Configuration"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Minimum Nodes"})}),(0,i.jsx)(n.td,{children:"At least 2 nodes"}),(0,i.jsx)(n.td,{children:"Enables cross-node communication for RDMA over InfiniBand; more nodes for scaling"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Operating System"})}),(0,i.jsx)(n.td,{children:"Ubuntu"}),(0,i.jsx)(n.td,{children:"Well-supported by NVIDIA drivers and software stack; other OS options may be available"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Hardware"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://www.nvidia.com/en-us/networking/ethernet-adapters/",children:"Mellanox ConnectX NICs"})}),(0,i.jsx)(n.td,{children:"High-performance network interface cards (NICs) for RDMA over InfiniBand support"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"VM Size"})," (with GPUs)"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-machines/sizes/gpu-accelerated/nd-family",children:"ND-series"})}),(0,i.jsxs)(n.td,{children:["NVIDIA GPU-enabled VMs with InfiniBand support; e.g., ",(0,i.jsx)(n.code,{children:"Standard_ND96asr_v4"})," or ",(0,i.jsx)(n.code,{children:"Standard_ND96isr_H100_v5"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.strong,{children:"VM Size"})," (without GPUs)"]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-machines/setup-infiniband#rdma-capable-instances",children:"RDMA capable instances"})," like ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-machines/hbv2-series-overview",children:"HBv2"}),", ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-machines/hbv3-series-overview",children:"HBv3"})," or ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/virtual-machines/hbv4-series-overview",children:"HBv4"})," series."]}),(0,i.jsxs)(n.td,{children:["High performance compute machines with Infiniband support; e.g., ",(0,i.jsx)(n.code,{children:"Standard_HB120rs_v3"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"GPUDirect RDMA"})}),(0,i.jsx)(n.td,{children:"Optional; requires GPU-enabled VMs (e.g., ND-series with A100 or H100 GPUs)"}),(0,i.jsx)(n.td,{children:"Enables direct GPU-to-GPU communication; omit GPUs for non-GPUDirect RDMA use cases"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"register-aks-infiniband-support-feature",children:"Register AKS Infiniband Support Feature"}),"\n",(0,i.jsx)(n.p,{children:"To ensure that the machines in the nodepool land on the same physical Infiniband network, you need to register the AKS Infiniband Support feature."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'az feature register --name AKSInfinibandSupport --namespace Microsoft.ContainerService\naz feature show \\\n  --namespace "Microsoft.ContainerService" \\\n  --name AKSInfinibandSupport\n'})}),"\n",(0,i.jsx)(n.h3,{id:"nodepool-with-gpus",children:"Nodepool with GPUs"}),"\n",(0,i.jsx)(n.h4,{id:"gpu-operator-managed-gpu-driver",children:"GPU Operator Managed GPU Driver"}),"\n",(0,i.jsxs)(n.p,{children:["To create an AKS nodepool ",(0,i.jsx)(n.strong,{children:"without"})," GPU Driver installation by AKS and with ",(0,i.jsx)(n.a,{href:"/aks-rdma-infiniband/configurations/gpu-drivers#option-2-gpu-operator-deployment",children:"GPU Operator"}),", use the following command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'az aks nodepool add \\\n  --resource-group "${AZURE_RESOURCE_GROUP}" \\\n  --cluster-name "${CLUSTER_NAME}" \\\n  --name "${NODEPOOL_NAME}" \\\n  --node-count "${NODEPOOL_NODE_COUNT}" \\\n  --node-vm-size "${NODEPOOL_VM_SIZE}" \\\n  --os-sku Ubuntu \\\n  # highlight-next-line\n  --gpu-driver none\n'})}),"\n",(0,i.jsx)(n.h4,{id:"aks-managed-gpu-driver",children:"AKS Managed GPU Driver"}),"\n",(0,i.jsxs)(n.p,{children:["To create an AKS nodepool ",(0,i.jsx)(n.strong,{children:"with"})," GPU Driver installation by AKS and ",(0,i.jsx)(n.strong,{children:"without"})," GPU Operator, use the following command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'az aks nodepool add \\\n  --resource-group "${AZURE_RESOURCE_GROUP}" \\\n  --cluster-name "${CLUSTER_NAME}" \\\n  --name "${NODEPOOL_NAME}" \\\n  --node-count "${NODEPOOL_NODE_COUNT}" \\\n  --node-vm-size "${NODEPOOL_VM_SIZE}" \\\n  --os-sku Ubuntu\n'})}),"\n",(0,i.jsx)(n.h3,{id:"nodepool-without-gpus",children:"Nodepool without GPUs"}),"\n",(0,i.jsx)(n.p,{children:"To create an AKS nodepool backed by non-GPU VMs, use the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'az aks nodepool add \\\n  --resource-group "${AZURE_RESOURCE_GROUP}" \\\n  --cluster-name "${CLUSTER_NAME}" \\\n  --name "${NODEPOOL_NAME}" \\\n  --node-count "${NODEPOOL_NODE_COUNT}" \\\n  --node-vm-size "${NODEPOOL_VM_SIZE}" \\\n  --os-sku Ubuntu\n'})}),"\n",(0,i.jsx)(n.h2,{id:"appendix",children:"Appendix"}),"\n",(0,i.jsx)(n.h3,{id:"understanding-vm-size-naming-convention-of-nd-series",children:"Understanding VM Size Naming Convention of ND-series"}),"\n",(0,i.jsx)(n.p,{children:"Azure VM sizes use a naming convention to indicate their hardware capabilities. The table below explains the components of VM sizes relevant to RDMA over InfiniBand, and GPUDirect RDMA support in AKS, with examples from the ND-series."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"N"})}),(0,i.jsx)(n.td,{children:"NVIDIA GPU-enabled"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"D"})}),(0,i.jsx)(n.td,{children:"Training and inference capable"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"r"})}),(0,i.jsx)(n.td,{children:"RDMA capable"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"a"})}),(0,i.jsx)(n.td,{children:"AMD CPUs"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"s"})}),(0,i.jsx)(n.td,{children:"Premium storage capable"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"vX"})}),(0,i.jsx)(n.td,{children:"Version/generation (e.g., v4, v5)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Number"})}),(0,i.jsx)(n.td,{children:"vCPUs (e.g., 96)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"GPU"})}),(0,i.jsx)(n.td,{children:"Specific GPU model (e.g., H100)"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"examples",children:"Examples"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Standard_ND96asr_v4"}),": NVIDIA GPUs (N), Training and inference (D), AMD CPUs (a), premium storage (s), RDMA (r), A100 GPUs, 96 vCPUs, version 4 (v4)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Standard_ND96isr_H100_v5"}),": NVIDIA GPUs (N), Training and inference (D), RDMA (r), premium storage (s), H100 GPUs, 96 vCPUs, version 5 (v5)."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var s=r(6540);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);